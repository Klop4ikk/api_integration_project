<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–Ω–∏–≥ - API –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .book-card {
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }
        .btn-gradient {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            transition: all 0.3s;
        }
        .btn-gradient:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            color: white;
        }
        .api-badge {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            border-left: 4px solid #667eea;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .status-online {
            background-color: #28a745;
            animation: pulse 2s infinite;
        }
        .status-offline {
            background-color: #dc3545;
        }
        .status-warning {
            background-color: #ffc107;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .debug-info {
            font-size: 12px;
            color: #666;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            display: none;
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        .toast {
            min-width: 300px;
        }
    </style>
</head>
<body>
    <!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="toast-container">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                –°–æ–æ–±—â–µ–Ω–∏–µ
            </div>
        </div>
    </div>

    <div class="container py-5">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="text-center mb-5 text-white">
            <h1 class="display-4 fw-bold mb-3">
                <i class="fas fa-book-open me-3"></i>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∫–Ω–∏–≥
            </h1>
            <p class="lead">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å REST API</p>
            <div class="d-inline-block px-3 py-2 bg-white rounded-pill text-dark mb-3">
                <span id="statusIndicator" class="status-indicator status-online"></span>
                –°—Ç–∞—Ç—É—Å API: <span id="apiStatus">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
            </div>
            <div>
                <button class="btn btn-sm btn-light me-2" onclick="showDebugInfo()">
                    <i class="fas fa-bug me-1"></i>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
                </button>
                <button class="btn btn-sm btn-light" onclick="location.reload()">
                    <i class="fas fa-redo me-1"></i>–û–±–Ω–æ–≤–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div id="debugInfo" class="debug-info">
            <strong>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:</strong><br>
            <div id="debugDetails"></div>
        </div>

        <div class="row">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
            <div class="col-md-4 mb-4">
                <div class="glass-card p-4 h-100">
                    <h3 class="mb-4 text-purple">
                        <i class="fas fa-plus-circle me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É
                    </h3>
                    <form id="addBookForm">
                        <div class="mb-3">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏</label>
                            <input type="text" class="form-control" id="bookTitle" 
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞—Å—Ç–µ—Ä –∏ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ê–≤—Ç–æ—Ä</label>
                            <input type="text" class="form-control" id="bookAuthor" 
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∏—Ö–∞–∏–ª –ë—É–ª–≥–∞–∫–æ–≤" required>
                        </div>
                        <button type="submit" class="btn btn-gradient w-100" id="submitBtn">
                            <i class="fas fa-save me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É
                        </button>
                    </form>
                    
                    <div class="mt-4">
                        <h5 class="mb-3">
                            <i class="fas fa-bolt me-2"></i>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                        </h5>
                        <button class="btn btn-outline-primary w-100 mb-2" onclick="getAllBooks()">
                            <i class="fas fa-sync-alt me-2"></i>–û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫
                        </button>
                        <div class="btn-group w-100">
                            <button class="btn btn-outline-info" onclick="testAPI('localhost')">
                                <i class="fas fa-plug me-1"></i>localhost
                            </button>
                            <button class="btn btn-outline-info" onclick="testAPI('127')">
                                <i class="fas fa-plug me-1"></i>127.0.0.1
                            </button>
                        </div>
                        <button class="btn btn-outline-danger w-100 mt-2" onclick="testError()">
                            <i class="fas fa-exclamation-triangle me-2"></i>–¢–µ—Å—Ç –æ—à–∏–±–∫–∏
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥ -->
            <div class="col-md-8">
                <div class="glass-card p-4 h-100">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3 class="mb-0 text-purple">
                            <i class="fas fa-list me-2"></i>–°–ø–∏—Å–æ–∫ –∫–Ω–∏–≥
                        </h3>
                        <div>
                            <span class="badge bg-primary fs-6" id="bookCount">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            <button class="btn btn-sm btn-outline-secondary ms-2" onclick="exportBooks()">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="loading" id="loading">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        </div>
                        <p class="mt-2">–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–Ω–∏–≥–∏...</p>
                    </div>
                    
                    <div id="booksList" class="row g-3">
                        <!-- –ö–Ω–∏–≥–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                    
                    <!-- –ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤ -->
                    <div class="mt-5">
                        <h4 class="mb-3">
                            <i class="fas fa-code me-2"></i>–ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤
                        </h4>
                        <div class="api-badge p-3 mb-2">
                            <small>GET –≤—Å–µ –∫–Ω–∏–≥–∏:</small><br>
                            <code id="apiUrl1">fetch('http://localhost:5000/api/books')</code>
                            <button class="btn btn-sm btn-outline-secondary float-end" onclick="copyToClipboard('apiUrl1')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="api-badge p-3">
                            <small>POST –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É:</small><br>
                            <code id="apiUrl2">fetch('http://localhost:5000/api/books', {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify({title: "...", author: "..."})
                            })</code>
                            <button class="btn btn-sm btn-outline-secondary float-end" onclick="copyToClipboard('apiUrl2')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ -->
        <div class="glass-card p-4 mt-4 text-center">
            <h5><i class="fas fa-info-circle me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ</h5>
            <p class="mb-0">REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–Ω–∏–≥–∞–º–∏ | Python + Flask | –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è —É—á–µ–±–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</p>
            <p class="mb-0">
                <button class="btn btn-link btn-sm" onclick="checkAllEndpoints()">
                    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ endpoints
                </button>
            </p>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥—Ä–µ—Å–æ–≤
        const API_HOSTS = [
            'http://localhost:5000/api',
            'http://127.0.0.1:5000/api',
            'http://0.0.0.0:5000/api'
        ];
        
        let API_BASE = API_HOSTS[0]; // –ù–∞—á–∏–Ω–∞–µ–º —Å localhost
        let currentHostIndex = 0;
        
        // Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showToast(title, message, type = 'info') {
            const toastEl = document.getElementById('liveToast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            const toast = new bootstrap.Toast(toastEl);
            toastEl.className = `toast ${type}`;
            
            toast.show();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
        function showDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            const debugDetails = document.getElementById('debugDetails');
            
            debugDetails.innerHTML = `
                –¢–µ–∫—É—â–∏–π API –∞–¥—Ä–µ—Å: ${API_BASE}<br>
                –í—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏: ${new Date().toLocaleTimeString()}<br>
                –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–¥—Ä–µ—Å–∞: ${API_HOSTS.join(', ')}<br>
                User Agent: ${navigator.userAgent}<br>
                –û–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å: ${navigator.onLine ? '‚úÖ –û–Ω–ª–∞–π–Ω' : '‚ùå –û—Ñ—Ñ–ª–∞–π–Ω'}
            `;
            
            debugInfo.style.display = debugInfo.style.display === 'none' ? 'block' : 'none';
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤
        async function testAPI(hostType) {
            const testHost = hostType === 'localhost' ? API_HOSTS[0] : API_HOSTS[1];
            showLoading(true);
            
            try {
                const startTime = Date.now();
                const response = await fetch(`${testHost}/books`);
                const endTime = Date.now();
                const responseTime = endTime - startTime;
                
                if (response.ok) {
                    showToast('‚úÖ –£—Å–ø–µ—Ö', `${testHost} –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ ${responseTime}–º—Å`, 'success');
                    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —Ä–∞–±–æ—á–∏–π —Ö–æ—Å—Ç
                    API_BASE = testHost;
                    updateApiUrls();
                    checkAPIStatus();
                    getAllBooks();
                } else {
                    showToast('‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ', `${testHost} –≤–µ—Ä–Ω—É–ª ${response.status}`, 'warning');
                }
            } catch (error) {
                showToast('‚ùå –û—à–∏–±–∫–∞', `${testHost} –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`, 'danger');
            } finally {
                showLoading(false);
            }
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ URL –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö –∫–æ–¥–∞
        function updateApiUrls() {
            document.getElementById('apiUrl1').textContent = `fetch('${API_BASE}/books')`;
            document.getElementById('apiUrl2').textContent = `fetch('${API_BASE}/books', {\n    method: 'POST',\n    headers: {'Content-Type': 'application/json'},\n    body: JSON.stringify({title: "...", author: "..."})\n})`;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É API...');
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º localhost
            testAPI('localhost').then(() => {
                // –ï—Å–ª–∏ localhost –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª, —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–æ–±—É–µ–º 127.0.0.1
                setTimeout(() => {
                    if (document.getElementById('apiStatus').textContent.includes('–û—Ñ—Ñ–ª–∞–π–Ω')) {
                        console.log('localhost –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω, –ø—Ä–æ–±—É–µ–º 127.0.0.1...');
                        testAPI('127');
                    }
                }, 2000);
            });
        };
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
        async function checkAPIStatus() {
            const statusElement = document.getElementById('apiStatus');
            const statusIndicator = document.getElementById('statusIndicator');
            
            statusElement.innerHTML = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
            statusIndicator.className = 'status-indicator';
            
            try {
                const response = await fetch(`${API_BASE}/books`);
                
                if (response.ok) {
                    statusElement.innerHTML = '<span class="text-success">–û–Ω–ª–∞–π–Ω</span>';
                    statusIndicator.className = 'status-indicator status-online';
                } else {
                    statusElement.innerHTML = '<span class="text-warning">–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞</span>';
                    statusIndicator.className = 'status-indicator status-warning';
                }
            } catch (error) {
                statusElement.innerHTML = '<span class="text-danger">–û—Ñ—Ñ–ª–∞–π–Ω</span>';
                statusIndicator.className = 'status-indicator status-offline';
                
                // –ü–æ–ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π —Ö–æ—Å—Ç
                currentHostIndex = (currentHostIndex + 1) % API_HOSTS.length;
                API_BASE = API_HOSTS[currentHostIndex];
                updateApiUrls();
                
                console.log(`–ü–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ ${API_BASE}, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥...`);
                setTimeout(checkAPIStatus, 5000);
            }
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–Ω–∏–≥–∏
        async function getAllBooks() {
            showLoading(true);
            try {
                const response = await fetch(`${API_BASE}/books`);
                
                if (!response.ok) {
                    throw new Error(`HTTP –æ—à–∏–±–∫–∞: ${response.status}`);
                }
                
                const data = await response.json();
                const books = data.books || data; // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞
                
                const booksList = document.getElementById('booksList');
                const bookCount = document.getElementById('bookCount');
                
                booksList.innerHTML = '';
                
                if (Array.isArray(books)) {
                    bookCount.textContent = `${books.length} –∫–Ω–∏–≥(–∏)`;
                    
                    if (books.length === 0) {
                        booksList.innerHTML = `
                            <div class="col-12 text-center py-5">
                                <i class="fas fa-book fa-3x text-muted mb-3"></i>
                                <p class="text-muted">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–Ω–∏–≥—É!</p>
                            </div>
                        `;
                    } else {
                        books.forEach(book => {
                            const bookCard = `
                                <div class="col-md-6">
                                    <div class="book-card card h-100">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between">
                                                <h5 class="card-title">${book.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h5>
                                                <span class="badge bg-primary">ID: ${book.id || 'N/A'}</span>
                                            </div>
                                            <p class="card-text">
                                                <i class="fas fa-user-pen text-secondary me-2"></i>
                                                ${book.author || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä'}
                                            </p>
                                            ${book.year ? `<p class="card-text"><small>–ì–æ–¥: ${book.year}</small></p>` : ''}
                                            <button class="btn btn-sm btn-outline-primary" onclick="getBook(${book.id})">
                                                <i class="fas fa-eye me-1"></i>–ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger ms-2" onclick="deleteBook(${book.id})">
                                                <i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                            booksList.innerHTML += bookCard;
                        });
                    }
                } else {
                    bookCount.textContent = '–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö';
                    showError('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–Ω–∏–≥: ' + error.message);
                bookCount.textContent = '–û—à–∏–±–∫–∞';
            } finally {
                showLoading(false);
            }
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –æ–¥–Ω—É –∫–Ω–∏–≥—É
        async function getBook(id) {
            try {
                const response = await fetch(`${API_BASE}/books/${id}`);
                if (response.ok) {
                    const book = await response.json();
                    showToast(
                        `üìñ ${book.title}`,
                        `–ê–≤—Ç–æ—Ä: ${book.author}<br>ID: ${book.id}${book.year ? `<br>–ì–æ–¥: ${book.year}` : ''}`,
                        'info'
                    );
                } else {
                    showError('–ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É
        async function deleteBook(id) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–Ω–∏–≥—É?')) {
                try {
                    const response = await fetch(`${API_BASE}/books/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        showSuccess('–ö–Ω–∏–≥–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!');
                        getAllBooks();
                    } else {
                        const error = await response.json();
                        showError(error.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
                    }
                } catch (error) {
                    showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message);
                }
            }
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–Ω–∏–≥—É
        document.getElementById('addBookForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const title = document.getElementById('bookTitle').value.trim();
            const author = document.getElementById('bookAuthor').value.trim();
            const submitBtn = document.getElementById('submitBtn');
            
            if (!title || !author) {
                showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ...';
            
            try {
                const response = await fetch(`${API_BASE}/books`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ title, author })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showSuccess(`–ö–Ω–∏–≥–∞ "${title}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!`);
                    document.getElementById('addBookForm').reset();
                    getAllBooks();
                } else {
                    showError(data.error || `–û—à–∏–±–∫–∞ ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-save me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É';
            }
        });
        
        // –¢–µ—Å—Ç –æ—à–∏–±–∫–∏
        async function testError() {
            try {
                const response = await fetch(`${API_BASE}/books/999999`);
                if (!response.ok) {
                    const error = await response.json();
                    showToast('–¢–µ—Å—Ç –æ—à–∏–±–∫–∏', `${error.error} (—Å—Ç–∞—Ç—É—Å: ${response.status})`, 'warning');
                }
            } catch (error) {
                showToast('–¢–µ—Å—Ç –æ—à–∏–±–∫–∏', error.message, 'danger');
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ endpoints
        async function checkAllEndpoints() {
            const endpoints = ['/books', '/status'];
            let results = [];
            
            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`${API_BASE}${endpoint}`);
                    results.push(`${endpoint}: ${response.status} ${response.statusText}`);
                } catch (error) {
                    results.push(`${endpoint}: ‚ùå ${error.message}`);
                }
            }
            
            showToast('–ü—Ä–æ–≤–µ—Ä–∫–∞ endpoints', results.join('<br>'), 'info');
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –∫–Ω–∏–≥
        async function exportBooks() {
            try {
                const response = await fetch(`${API_BASE}/books`);
                const data = await response.json();
                const books = data.books || data;
                
                const jsonStr = JSON.stringify(books, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'books_export.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showSuccess('–ö–Ω–∏–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª books_export.json');
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ: ' + error.message);
            }
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent || element.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ', '–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
            }).catch(err => {
                showError('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å: ' + err);
            });
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        function showSuccess(message) {
            showToast('‚úÖ –£—Å–ø–µ—Ö', message, 'success');
        }
        
        function showError(message) {
            showToast('‚ùå –û—à–∏–±–∫–∞', message, 'danger');
        }
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            if (!document.getElementById('loading').style.display === 'block') {
                checkAPIStatus();
            }
        }, 30000);
        
        // –û–±–Ω–æ–≤–∏—Ç—å URL –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
        updateApiUrls();
    </script>
</body>
</html>